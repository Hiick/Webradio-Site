

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>


<!-- Core plugin JavaScript-->
<script src="{{ asset('vendor/jquery-easing/jquery.easing.min.js') }}"></script>
<script src="{{ asset('vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

<!-- Core plugin JavaScript-->
<script src="{{ asset('vendor/jquery-easing/jquery.easing.min.js') }}"></script>

<!-- Custom scripts for all pages-->
<script src="{{ asset('js/sb-admin-2.min.js') }}"></script>
<script src="{{ asset('js/mainJs/index.js') }}"></script>
<script>

$(document).ready(function() {

    let firebaseConfig;
    let downloadUrl;

    $.ajax({
    method: "GET", 
    url: "/profile/firebase", 
    async: true,
    success: function(data) {
    //console.log(data.apiKey+" "+data.authDomain+" "+data.databaseURL+" "+data.projectId+" "+data.storageBucket);
    
        firebaseConfig = {
            apiKey: data.apiKey,
            authDomain: data.authDomain,
            databaseURL: data.databaseURL,
            projectId: data.projectId,
            storageBucket: data.storageBucket
        };


        firebase.initializeApp(firebaseConfig);

        // On détecte le changement de fichier
        $('#cameraInput').on('change', function() {
            // On récupère le nouveau fichier
            let selectedFile = event.target.files[0];

        
            let filename = $('#cameraInput').val().replace(/C:\\fakepath\\/i, '');
            let storageRef = firebase.storage().ref('/User/{{ app.user.id }}' + filename);

            // On envoi le fichier à Firebase
            let upload = storageRef.put(selectedFile);

            // Le traitement Firebase se fait ici
            upload.on('state_changed', function(snapshot) {

            }, function(error) {
                // Si Firebase renvoi une error on l'a met ici
                console.log(error)
            }, function() {
                // On récupère l'URL téléchargeable
                downloadUrl = upload.snapshot.downloadURL;
                // On l'affiche
                 console.log(downloadUrl);
            
                // On remplace l'URL de l'image par la nouvelle
                    $('#profil').attr('src', downloadUrl);
                    $('#logo-setting').attr('src', downloadUrl)


                        $('#envoyer').click(function(e){
                            e.preventDefault();
                            console.log(downloadUrl)

                             let username = $('#username').val();

                                 $(".erreur").remove();

                                if (username.length < 3) 
                                {
                                    $('#username').after('<div class="erreur text-dark medium" style="font-size: small; margin-top: 10px;">Le nom d\'utilisateur doit être de 3 caractères minimum et ne peux pas contenir d\'espace</div>'); 
                                }else if(username.length > 10)
                                {
                                    $('#username').after('<div class="erreur text-dark medium" style="font-size: small; margin-top: 10px;">Le nom d\'utilisateur doit être  moins de 10 caractères</div>');
                                }
    

                            $.ajax({
                                    type: "POST", 
                                    url: "/profile/setting/{{app.user.id}}", 
                                    data: JSON.stringify({
                                        "downloadUrl": downloadUrl,
                                        "username": username,
                                    }),
                                    async: true,
                                    success: function(responseText) {
                                        console.log('ici succ');
                                    },
                                    error: function (error) {
                                        console.log(error);
                                    }
                            });

                        });  

                        $('#channelSave').click(function(e) {
                            e.preventDefault();
                            console.log(downloadUrl)

                            let channels = $('#channels').val();

                                 $(".erreur").remove();

                                if (channels.length < 3) 
                                {
                                    $('#channels').after('<div class="erreur text-dark medium" style="font-size: small; margin-top: 10px;">Le nom d\'utilisateur doit être de 3 caractères minimum et ne peux pas contenir d\'espace</div>'); 
                                }else if(channels.length > 10)
                                {
                                    $('#channels').after('<div class="erreur text-dark medium" style="font-size: small; margin-top: 10px;">Le nom d\'utilisateur doit être  moins de 10 caractères</div>');
                                }

                                if(channels.length > 3)
                                {
                                    $.ajax({
                                        type: "POST", 
                                        url: "/profile/setting/channel/{{app.user.id}}", 
                                        data: JSON.stringify({
                                            "downloadUrl": downloadUrl,
                                            "channels": channels,
                                        }),
                                        async: true,
                                        success: function(responseText) {
                                            console.log('ici succès');
                                            $('avatarChannel').attr('src', downloadUrl)
                                            $('#mychannels').css("display", "block");
                                        },
                                        error: function (error) {
                                            console.log(error);
                                        }
                                    }); 
                                }

                        });  

            });// i
        });

    }

    /*$('#savePassword').click(function(e) {
    e.preventDefault();
            let password = $('#password').val();

        if(password.length < 8) {
            $('#password').after('<div class="erreur text-dark medium" style="font-size: small; margin-top: 10px;">Merci de rentrer un mot de passe de 8 caractères minimum</div>');
        }
    
        if(password.length > 8)
        {
            $.ajax({
                type: "POST", 
                url: "/profile/setting/password/{{app.user.id}}", 
                data: JSON.stringify({
                    "password": password,
                }),
                async: true,
                success: function(responseText) {
                    console.log('ici succès');
                    
                    $('#mypassword').css("display", "block");
                },
                error: function (error) {
                    console.log(error);
                }
            }); 
        }
});   */

});
    
});
</script>